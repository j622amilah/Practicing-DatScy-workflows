\documentclass[11pt, onecolumn]{article}			
% \documentclass[font_size, pagestyle, page_column]{type_of_document}
% (page 17-19)
% This specifies what type of document you want to make, certain documents allow you to use certain commands and the formatting is different/specific for each type of document.  This document is called an article and it is the most standard type of document.


% -----------------------------------------
% Packages allow you to use extra commands (commands are always followed by a backslash (\). )  You can add as many packages as you like.  However, sometimes the order in which you list the packages can give errors.
% -----------------------------------------
\usepackage{graphicx}	% This package allow you to insert PostScript figures

\usepackage{amsmath} 	% This is a typical math package - it allows you to type certain known math symbols, like exp for expoential 
\usepackage{amssymb} 	% This is a typical math package
\usepackage{amsthm}		% This is a typical math package

\usepackage{color}		% This package allows you to use command with color, like colored text

\usepackage{hyperref}
\hypersetup{
    colorlinks=true,
    linkcolor=blue,
    filecolor=magenta,      
    urlcolor=cyan,
    pdftitle={Bikeshare Analysis},
    pdfpagemode=FullScreen,
    }
% -----------------------------------------


% -----------------------------------------
% Can change/adjust the page margins (page 24-26 - has diagram of margins)
% -----------------------------------------
\topmargin	=10.mm		% beyond 25.mm
\oddsidemargin	=0.mm		% beyond 25.mm
\evensidemargin	=0.mm		% beyond 25.mm
\headheight	=0.mm
\headsep	=0.mm
\textheight	=220.mm
\textwidth	=165.mm
\parindent  15.mm			% indent paragraph by this much
\parskip     2.mm			% space between paragraphs

\alph{footnote}		% make title footnotes alpha-numeric

\setlength{\parindent}{0pt}   % no indentation for the entire document
% -----------------------------------------




\title{Bikeshare Analysis}	% the document title

\author{Jamilah Foucher \\	% author information
%		Affiliation \\
%		Affilication \\
}

\date{\today}	% You can write any day or you can use \today, which inserts the current date

% --------------------- end of the preamble ---------------------------


\bibliographystyle{acm}		% Style of bibliography presentation

% -----------------------------------------
% This is the start of the body of the document.  The \begin{document} is required for all latex documents.
% -----------------------------------------
\begin{document}

\pagenumbering{roman}	% Roman numerals from abstract to text

\maketitle		% This command prints the title page

\thispagestyle{empty}	% no page number on THIS page 


% -----------------------------------------
% Abstract
% -----------------------------------------
%\begin{abstract}			% beginning of the abstract

%\end{abstract}				% end of the abstract
% -----------------------------------------

\newpage				% OPTIONAL: start a new page (it looks nice)

\tableofcontents		        % OPTIONAL: creates table of contents automatically

\newpage				% OPTIONAL: start a new page

\pagenumbering{arabic}	% You can specify the page numbers as a specific system/font.  Arabic is the default; can also use roman (lowercase Roman numerals), Roman (uppercase Roman numerals), alph (lowercase English letters), Alph (uppercase English letters)

% -------------------------------------------------
% Report needs to answer:

% 1. A clear statement of the business task
% 2. A description of all data sources used
% 3. Documentation of any cleaning or manipulation of data
% 4. A summary of your analysis
% 5. Supporting visualizations and key ﬁndings
% 6. Your top three recommendations based on your analysis
% -------------------------------------------------
\section{Project Summary/Executive Summary}

The objective of this work was to understand how annual members and casual riders use Cyclistic bikes diﬀerently, and then predict membership using key features from the Cyclistic data at an accuracy of 95\% or better. 

The Baseline Solution is to use at least the features trip$\_$time and rideable$\_$type to predict whether new customers are will be members or casual users; using a kmeans model, the member centroid location was estimated using the cosine similarity distance measure. Thus the distance from the estimated centroid to each feature (trip$\_$time, rideable$\_$type, and birthyear) was calculated and the feature with the largest deviation (ie: outlier) was suggested as a marketing recommendation.  

The methodology used to implement the baseline solution, train and test lifestyle prediction models, is classification analysis using kmeans. The evaluation metric includes prediction accuracy for the test dataset, and feature distance difference from the member centroid location.

In summary, the project/business objective was SATISFIED because the baseline solution produced an analysis result showing that membership likelihood can be predicted at 98\% accuracy for the test data. In addition, the predominate recommendations based on outliers for predicted casual users were in alignment with statistically significant variables for member vs casual, such as trip$\_$time and birthyear.  

The project can be improved by collecting more data from casual users and women; the dataset was statistically significantly (one sample z-test: $p < 0.05$) biased to male members. Higher prediction accuracy between members and casual users or better detection of outliers, maybe possible if demographic samples were equally represented.

\section{Business Objective/Ask}

The business objective provides a list of problems that need to be solved, with measurable objectives of successful for each solved problem. The first problem should correspond with the last problem (Act), because it shows that the main global problem was indeed solved by the specific problems. The problems that need to be solved for the bikeshare analysis, from general to specific, are : 

\begin{itemize}
\item Cyclistic bikes needs to gain more money to stay in business, by converting casual users into members. Measurable success for this task is creating a marketing campaign that increases more new members in comparison to casual users.
\item In order to convert casual users into members, one needs to understand which key factors/features identify a person as a member in comparison to a casual user. Measurable success for this task is to statistically prove which factors/features are statistically different for casual users in comparison to members.
\item A model needs to be built using the key factors/features, such that one can predict whether a new customer will be a member or a casual user. Measurable success for this task is to measure prediction accuracy of 95\% or better in identifying members in comparison to casual users, using a test dataset.
\item If a new customer is predicted to be a casual user, the model needs to show which factor/feature of the new customer's profile needs to be modified such that they would become a member. Measurable success is to rank the factors/features from strongest to weakest predictors for a member, using either the statistical analysis significance of factors or feature importance/SHAP. The model should recommend improvements of the strongest member predictors more than the weakest member predictors, measurable success that recommendations are correct is to perform a group by count of how many times the model recommended a feature for predicted casual users.
\item Act: Marketing needs to create marketing campaigns for each of the key factors/features, such that casual users deficient in these key factors/features would be given marketing that would change their ideas/behavior about the member-deficient key factors/features such that they would start to think/behave similarly to members. Measurable success for this task is observing an increase in more new members in comparison to casual users, as was stated in the first problem/objective; thus solving the global problem by executing the specific problems.
\end{itemize}


\section{Project Background}

Cyclistic is a bike-share program that features more than 5,800 bicycles and 600 docking stations. Cyclistic sets itself apart by also oﬀering reclining bikes, hand tricycles, and cargo bikes, making bike-share more inclusive to people with disabilities and riders who can’t use a standard two-wheeled bike. The majority of riders opt for traditional bikes; about 8 percent of riders use the assistive options. Cyclistic users are more likely to ride for leisure, but about 30 percent use them to commute to work each day. 

Future success of Cyclistic depends on maximizing the number of annual memberships, thus it is necessary to design a new marketing strategy to convert casual riders into annual members. Casual riders are customers who purchase single-ride or full-day passes, and Cyclistic members are customers who purchase annual memberships. 

There are three teams that operate Cyclistic : 
\begin{itemize}
\item Manager: responsible for promoting the program (social, media, email, etc)
\item Marketing analytics team : responsible for doing the data analysis
\item Executive team: responsible for approving the proposal
\end{itemize}


\section{Baseline Solution}

The Baseline Solution (top three recommendations) is to :
\begin{enumerate}
\item use trip$\_$time, rideable$\_$type, and birthyear to predict member$\_$casual. 
\item recommend bike routes: if the model predicts that a new customer is a casual user and the feature furthest away from the member cluster is trip$\_$time, marketing should encourage usage of the bikes like a member such as recommending short trip time routes that are beautiful/interesting.
\item recommend bike usage type: if the model predicts that a new customer is a casual user and the feature furthest away from the member cluster is rideable$\_$type, marketing should encourage usage of member bike preferences such as classic or electric bikes 
\item recommend age-targeted activities/appearances: if the model predicts that a new customer is a casual user and the feature furthest away from the member cluster is birthyear, marketing should encourage age related activities connected with membership. Members are typically six years older than casual user, if age is used a marketing tool there could be two types of age populations that are members.
\end{enumerate}


\section{Project Deliverables}

\subsection{Prepare}
% Should talk about the reliability of data (integrity, credibility, errors)
% Should explain how the data was used to answer the problems
The bikeshare data from the AWS bucket was assumed to have data integrity, credibility, with minimal errors because it was given directly from a trustworthy source (the company). Null values were filled using the population mean for the particular value. Data filtering could be performed, such as removing data from unrealistic ranges to improve data integrity and credibility.


\subsection{Methodology/Process}
% Should document data cleaning and manipulation steps
An automatic GCP ingestion program was written in bash that: 
\begin{enumerate}
\item Downloaded the data from the public bucket using the AWS SDK,
\item organized/unzipped the zip files into three folders (csvdata, remaining$\_$files, zipdata),
\item Evaluated the header of each csv file using the first header file as a main reference of comparison for all the other files; similar words with respect to the main reference header were replaced in each csv file. Three folders were created such that identical csv files could be grouped together: exact$\_$match$\_$header, no$\_$match$\_$header, similar$\_$match$\_$header. The evaluation algorithm was re-run on the files in the similar$\_$match$\_$header folder to find all unique table types, in a recursive decision tree like fashion.
\item Files in each of the exact$\_$match$\_$header folders were uploaded to GCP and a UNION operation was performed to append all the csv files; for this analysis two table types were found. The two types of datasets were: A) 39 datasets targeting latitude \& longitude, member type, and bike preference (rideable$\_$type), B) 25 datasets targeting trip duration, member type (usertype), gender, and birthyear. The two large datasets were joined using a FULL JOIN on the ride$\_$id and trip$\_$id primary key. The SQL table was reduced to 12 columns: fin$\_$trip$\_$ID, rideable$\_$type, trip$\_$time, fin$\_$stsname, fin$\_$stsID, fin$\_$esname, fin$\_$esID, trip$\_$distance, member$\_$casual, bikeid$\_$INT, gender, birthyear. 
\item An automatic bigquery statistical analysis program was written such that main features/columns were compared with the member$\_$casual column; two categorical columns [rideable$\_$type, gender] and three numerical columns [trip$\_$distance, trip$\_$time, birthyear]. The categorical columns were evaluated by calculation the probability of occurrence, and the numerical columns were evaluated using the one and two sample z-statistic with respect to the population and individual sample means respectively.
\item A bigquery kmeans ML model was used to predict the binary label member$\_$casual using the three features.
\item  Outlier detection via the kmeans model, using the difference from average member centroid feature values to sample feature values, was used to give marketing recommendations to make casual users into members. 
\end{enumerate}

\subsection{Analyze}
The numerical z-statistic results show that member statistically have shorter trip$\_$time than casual users, also members are statistically older than casual users by 6 years. In terms of occurrence, men are more likely to be members than women because more men use bikes. Classic and electric bikes tend to be used more by members than casual members. Based on these statistics, casual riders might buy annual membership if they grow older, have an age similar to the average age of membership. Similarly, casual riders might buy membership if they start to desire to do short trip time sessions, or have a preference for classic or electric bikes . Digital media about a short organized trip routes, usage of classic or electric bikes, and marketing for young adults might help casual users to become members; members like short trip time sessions and classic or electric bikes. Also, young adults are less likely to be members so special marketing to non-likely member candidates may encourage them to join thus gaining more money for Cyclistic; older adults are already motivated to be members so they need little to no marketing.

The categorical probability of occurrence of each feature for member$\_$casual shows that the dataset was statistically bias for male member data ($p < 0.05$); roughly 30 percent of the data consisted of samples from male members. 

The key factors/features that were selected for the kmeans, a  clustering algorithm that is used to detect outliers, were the most statistically significant features found that distinguished members from causal riders; trip time, birthyear, and rideable type were found to be the most statistically relavant features in order of significance. The prediction accuracy of kmeans model for the test dataset was 98.25049%; refer to ACCURACY_RESULT in main.sh.

Feature recommendations were calculated by finding the feature furthest away from the member cluster. The equation in the Appendix was implemented to estimate the location of the member cluster, such that the feature furthest away from the member cluster could be found and given as a marketing recommendation to convert casual users into members. The results shows that the marketing recommendations that were given to casual users; trip time and birthyear were the most recommended forms of marketing which were in alignment with numerical feature statistical results. This analysis shows that kmeans is an effective way to recommend marketing using outlier detection of features. Please refer to RECOMMENDATION_RESULT in main.sh.

\subsection{Evaluation metrics}

Evaluation metrics were : 0) probability of occurrence for categorical features, 1) one and two sample z-statistic for numerical features, 2) one sample z-statistic for categorical features, 3) prediction accuracy for kmeans using the test dataset. The train test split percentage was 0.75 and 0.25 respectively.


\section{Recommendations for improving the project in the future}

The project can be improved by collecting more data from casual users and women; the dataset was statistically significantly (one sample z-test: $p < 0.05$) biased to male members. Higher prediction accuracy between members and casual users or better detection of outliers, maybe possible if demographic samples were equally represented.  



\section{Appendix}

\subsection{Calculation of the "should of, would of, could of" cluster centroid}

The "should of, would of, could of" cluster centroid (SWC$\_$centroid) is an equivalent point in feature space that represents the actual cluster centroid, using the assumption that all the features have the same value.

The goal is to solve for the A variables of the cosine similarity equation. The A variables are the feature values of the desired member cluster.

\begin{equation}
cos \theta = \frac{A \cdot B }{\|A\| \|B\|} = \frac{\sum^{n-1}_{i=0} A_i B_i}{\sqrt{\sum^{n-1}_{i=0} (A_i)^{2}} \sqrt{\sum^{n-1}_{i=0} (B_i)^{2}} }
\end{equation}

Move the B variables to the left side of the equation, because the B variables are the features and the values are known.

\begin{equation}
\left(  \frac{ \sqrt{\sum^{n-1}_{i=0} (B_i)^{2}} }{ \sum^{n-1}_{i=0} B_i } cos \theta  \right) = \frac{\sum^{n-1}_{i=0} A_i}{\sqrt{\sum^{n-1}_{i=0} (A_i)^{2}} }
\end{equation}

Square both sides to remove the square root on the denominator on the right side.

\begin{equation}
\left(  \frac{ \sqrt{\sum^{n-1}_{i=0} (B_i)^{2}} }{ \sum^{n-1}_{i=0} B_i } cos \theta  \right)^{2} = \left(  \frac{\sum^{n-1}_{i=0} A_i}{\sqrt{\sum^{n-1}_{i=0} (A_i)^{2}} } \right)^{2}
\end{equation}

\begin{equation}
\frac{ \sum^{n-1}_{i=0} (B_i)^{2}} { (\sum^{n-1}_{i=0} B_i)^{2} } cos^{2} \theta  =   \frac{(\sum^{n-1}_{i=0} A_i)^{2} }{\sqrt{\sum^{n-1}_{i=0} (A_i)^{2}} } 
\end{equation}

Let the left portion equal to EQN to simplify the equation. Write the summation out into series expansion to see how to reduce the right side equation.

\begin{equation}
EQN  =   \frac{(A_0 + A_1 + A_2 + \ldots)^{2} }{(A_{0}^{2} + A_{1}^{2} + A_{2}^{2} + \ldots)} 
\end{equation}

\begin{equation}
EQN  =   \frac{(A_0 + A_1 + A_2 + \ldots)(A_0 + A_1 + A_2 + \ldots) }{(A_{0}^{2} + A_{1}^{2} + A_{2}^{2} + \ldots)} 
\end{equation}

\begin{equation}
EQN  =   \frac{A_{0}^{2} + A_{1}^{2} + A_{2}^{2} + 2A_{0}A_{1} + 2A_{0}A_{2} + 2A_{1}A_{2} + \ldots }{A_{0}^{2} + A_{1}^{2} + A_{2}^{2} + \ldots} 
\end{equation}

\begin{equation}
EQN  =  2A_{0}A_{1} + 2A_{0}A_{2} + 2A_{1}A_{2} + \ldots
\end{equation}

Let the A variables equal each other, so that the estimated centroid distance for one feature does not bias the other features. 

Let $q = A_0 = A_1 = A_2 = \ldots $ 

\begin{equation}
EQN  =  2q^{2} + 2q^{2} + 2q^{2} + \ldots = n \cdot 2q^{2}
\end{equation}

Solve for q

\begin{equation}
q  =  \sqrt{ \frac{ EQN }{ n \cdot 2 }} = \sqrt{ \frac{ \frac{ \sum^{n-1}_{i=0} (B_i)^{2}} { (\sum^{n-1}_{i=0} B_i)^{2} } cos^{2} \theta }{ n \cdot 2 }}
\end{equation}

In GCP, q will be calculated per row/sample so the SWC$\_$centroid for the member centroid is the average of all the rows when member$\_$casual is equal to member.

\end{document}				% REQUIRED
